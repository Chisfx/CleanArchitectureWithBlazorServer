@using Blazor.Server.UI.Services.Layout
@inject IStringLocalizer<SharedResource> L
<Fluxor.Blazor.Web.StoreInitializer/>
<LoadingScreen LayoutService="LayoutService" LoadingDelayMs="@(Settings.EnableLoadingScreen ? Settings.LoadingScreenDuration : 0)">
    <CascadingAuthenticationState>
        <Router AppAssembly="@typeof(App).Assembly">
            <Found Context="routeData">
                <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                    <Authorizing>
                        <text>@L["Please wait, we are authorizing you..."]</text>
                    </Authorizing>
                    <NotAuthorized>
                        @if (context.User.Identity?.IsAuthenticated ?? false)
                        {
                            <p>@L["You are not authorized to be here. For more information, contact your system administrator."]</p>
                        }
                        else
                        {
                            <Login/>
                        }
                    </NotAuthorized>
                </AuthorizeRouteView>

            </Found>
            <NotFound>
                <PageTitle>Not found</PageTitle>
                <LayoutView Layout="@typeof(MainLayout)">
                    <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="d-flex">
                        <p role="alert">
                            @L["Sorry, there's nothing at this address."] <MudButton Variant="Variant.Filled" Size="Size.Small" Link="/">@L["Go Home"]</MudButton>
                        </p>
                    </MudContainer>
                </LayoutView>
            </NotFound>
        </Router>
    </CascadingAuthenticationState>
</LoadingScreen>

@code{

    [Inject]
    private LayoutService LayoutService { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        LayoutService.SetBaseTheme(Theme.Theme.ApplicationTheme());
        await LayoutService.ApplyUserPreferences(true);
    }

}